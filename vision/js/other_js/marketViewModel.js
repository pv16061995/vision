function marketHistory(n){var t=this,i,r,f,e,o,u;t.marketName=n.marketName;i=4;r=1e3;t.disableAnimation=!1;t.showColumns=ko.observable(!0);t.exchangeNounce=ko.observable(0);t.history=ko.observableArray([]);t.availableLength=[{value:"10"},{value:"25"},{value:"50"},{value:"100"},];t.selectedLength=ko.observable(t.availableLength[0]);t.pageIndex=ko.observable(0);t.maxPageIndex=ko.pureComputed(function(){return Math.ceil(t.history().length/t.selectedLength().value)-1});t.previousPage=function(){t.pageIndex()>0&&(t.disableAnimation=!0,t.pageIndex(t.pageIndex()-1),t.disableAnimation=!1)};t.firstPage=function(){t.pageIndex()>0&&(t.disableAnimation=!0,t.pageIndex(0),t.disableAnimation=!1)};t.nextPage=function(){t.pageIndex()<t.maxPageIndex()&&(t.disableAnimation=!0,t.pageIndex(t.pageIndex()+1),t.disableAnimation=!1)};t.lastPage=function(){t.pageIndex()<t.maxPageIndex()&&(t.disableAnimation=!0,t.pageIndex(t.maxPageIndex()),t.disableAnimation=!1)};t.allPages=ko.pureComputed(function(){var f=[],r=0,u=t.maxPageIndex(),n;for(t.pageIndex()<Math.floor(i/2)?u=i:t.pageIndex()>t.maxPageIndex()-i?r=t.maxPageIndex()-i:(r=t.pageIndex()-Math.floor(i/2),u=t.pageIndex()+Math.ceil(i/2)),n=r;n<=u;n++)f.push({pageNumber:n+1});return f});t.moveToPage=function(n){t.disableAnimation=!0;t.pageIndex(n);t.disableAnimation=!1};t.summaryHistory=ko.pureComputed(function(){var n=Number(t.selectedLength().value),i=Number(t.pageIndex()*n);return t.history.slice(i,i+n)});f=function(n){var i,f,e;n&&(i=n.serviceData,t.exchangeNounce()+1<i.Nounce?o():t.exchangeNounce()+1==i.Nounce&&(i.Fills&&($.each(i.Fills,function(){var n=new marketHistoryEntry({TimeStamp:this.TimeStamp,Price:this.Rate,Quantity:this.Quantity,Total:this.Rate*this.Quantity,OrderType:this.OrderType});t.history.unshift(n)}),t.history()[0]&&u("data-update-last-",t.history()[0].price),t.history().length>r&&(f=t.history().length-r,e=t.history().length-f,t.history.splice(e,f))),t.exchangeNounce(i.Nounce)))};e=function(n){var i,r;n&&(i=n.serviceData,i.Fills&&i.Fills.length>0&&(r=[],$.each(i.Fills,function(){var n=new marketHistoryEntry(this);r.push(n)}),t.history(r),u("data-update-last-",t.history()[0].price)),t.exchangeNounce(i.Nounce))};$("#event-store").on("data-update-exchange-"+t.marketName,f);$("#event-store").on("data-query-exchange-"+t.marketName,e);o=function(){$("#event-store").trigger({type:"request-query-exchange-"+t.marketName})};u=function(n,i){$("#event-store").trigger({type:n+t.marketName,serviceData:i})};t.resize=function(n){switch(n){case"xs":case"sm":t.showColumns("false");break;case"md":case"lg":t.showColumns("true")}};this.showRow=function(n){n.nodeType!==1||t.disableAnimation||($(n).hide(),$(n).fadeIn(1e3),$(n).addClass("dyn-tr-add"))}}function proofOfDev(n){var t=this;t.type=ko.observable("");t.rating=ko.observable(0);t.hasPlus=ko.observable(!1);t.link=ko.observable("");n.CryptoAsian?(t.type("CryptoAsian"),$.isNumeric(n.CryptoAsian.rating)?t.rating(parseInt(n.CryptoAsian.rating)):(t.rating(parseInt(n.CryptoAsian.rating.charAt(0))),t.hasPlus(n.CryptoAsian.rating.length>1&&n.CryptoAsian.rating.charAt(1)=="+")),t.link(n.CryptoAsian.link)):n.CoinsSource&&(t.type("Coinssource"),$.isNumeric(n.CoinsSource.rating)&&t.rating(parseInt(n.CoinsSource.rating)),t.link(n.CoinsSource.link))}function persona(n){var t=this;t.name=ko.observable(n.Name);t.location=ko.observable(n.Location)}function marketInformation(n){var t=this,u=n.marketName,r=n.marketEx,i;t.visible=ko.observable(!1);t.twitter=ko.observable("");t.website=ko.observable("");t.description=ko.observable("");t.blockexplorer=ko.observable("");t.pod=ko.observable(null);t.hasPod=ko.observable(!1);t.persona=ko.observable(null);t.hasPersona=ko.observable(!1);i=function(n){n&&Object.getOwnPropertyNames(n).length!==0&&!n.data&&n.data!="none"&&(t.visible(!0),n.twitter&&t.twitter(n.twitter),n.website&&t.website(n.website),n.description&&t.description(n.description),n.blockexplorer&&t.blockexplorer(n.blockexplorer),n.pod&&n.pod!="none"&&(t.hasPod(!0),t.pod(new proofOfDev(n.pod))),n.persona&&(t.hasPersona(!0),t.persona(new persona(n.persona))))};i(r)}function marketOrderBook(n){"use strict";function c(i){var a;if(i)if(a=i.serviceData,e+1<a.Nounce)console.log("marketOrderBook.exchangeUpdated: nounce out of sync"),h();else if(e+1==a.Nounce){if(console.log("marketOrderBook.exchangeUpdated: nounce synced"),a.Buys){var c=t.sumBuysBase(),l=t.sumBuysMarket(),v=function(i){var r=new orderBookEntry(i,n);t.buys.push(r);c+=r.total();l+=r.size()};$.each(a.Buys,function(){var i=this,f,n,r,e,o,s;switch(i.Type){case 0:v(i);break;case 1:f=t.buys.remove(function(n){return n.rate()==i.Rate});f.length>0&&(c-=f[0].total(),l-=f[0].size());break;case 2:n=ko.utils.arrayFirst(t.buys(),function(n){return i.Rate===n.rate()});n?(e=n.total(),o=n.size(),n.update(i),c+=n.total()-e,l+=n.size()-o):(r=u.find(function(n){return n.Rate==i.Rate}),r!=null&&r.length>0?(e=n.total(),o=n.size(),n.update(r[0]),c+=n.total()-e,l+=n.size()-o,s=u.indexOf(r[0]),s>-1&&u.splice(s,1)):v(i))}});t.buys.sort(function(n,t){return n.rate()==t.rate()?0:n.rate()>t.rate()?-1:1});o(t.buys().length>0?t.buys()[0].rate():0);t.sumBuysBase(c);t.sumBuysMarket(l);y();r()}if(a.Sells){var c=t.sumSellsBase(),l=t.sumSellsMarket(),w=function(i){var r=new orderBookEntry(i,n);t.sells.push(r);c+=r.total();l+=r.size()};$.each(a.Sells,function(){var i=this,u,n,r,e,o,s;switch(i.Type){case 0:w(i);break;case 1:u=t.sells.remove(function(n){return n.rate()==i.Rate});u.length>0&&(c-=u[0].total(),l-=u[0].size());break;case 2:n=ko.utils.arrayFirst(t.sells(),function(n){return i.Rate===n.rate()});n?(e=n.total(),o=n.size(),n.update(i),c+=n.total()-e,l+=n.size()-o):(r=f.find(function(n){return n.Rate==i.Rate}),r!=null&&r.length>0?(e=n.total(),o=n.size(),n.update(r[0]),c+=n.total()-e,l+=n.size()-o,s=f.indexOf(r[0]),s>-1&&f.splice(s,1)):w(i))}});t.sells.sort(function(n,t){return n.rate()==t.rate()?0:n.rate()<t.rate()?-1:1});s(t.sells().length>0?t.sells()[0].rate():0);t.sumSellsBase(c);t.sumSellsMarket(l);p();r()}e=a.Nounce}}function l(i){if(i.serviceData){var u=i.serviceData;switch(u.Type){case 0:u.Order.Exchange==n.marketName&&(u.Order.OrderType=="BUY"||u.Order.OrderType=="LIMIT_BUY"?t.myBuys.push(u.Order.Limit):(u.Order.OrderType=="SELL"||u.Order.OrderType=="LIMIT_SELL")&&t.mySells.push(u.Order.Limit));r();break;case 2:case 3:u.Order.Exchange==n.marketName&&(u.Order.OrderType=="BUY"||u.Order.OrderType=="LIMIT_BUY"?t.myBuys=_.without(t.myBuys,u.Order.Limit):(u.Order.OrderType=="SELL"||u.Order.OrderType=="LIMIT_SELL")&&(t.mySells=_.without(t.mySells,u.Order.Limit)));r()}}}function a(i){var a=100,h;if(t.disableAnimation=!0,i){if(h=i.serviceData,console.log("marketOrderBook.exchangeQueried "),h.Buys&&h.Buys.length>0){var v=[],c=0,l=0;t.showAll()||(u=h.Buys.slice(a),h.Buys=h.Buys.slice(0,a));$.each(h.Buys,function(){var t=new orderBookEntry(this,n);c+=t.total();l+=t.size();t.sumBase(c);t.sumMarket(l);v.push(t)});o(v.length>0?v[0].rate():0);$.each(u,function(){var n=this;l+=n.Quantity;c+=n.Quantity*n.Rate});t.sumBuysBase(c);t.sumBuysMarket(l);t.buys(v)}if(h.Sells&&h.Sells.length>0){var y=[],c=0,l=0;t.showAll()||(f=h.Sells.slice(a),h.Sells=h.Sells.slice(0,a));$.each(h.Sells,function(){var t=new orderBookEntry(this,n);c+=t.total();l+=t.size();t.sumBase(c);t.sumMarket(l);y.push(t)});s(y.length>0?y[0].rate():0);$.each(f,function(){var n=this;l+=n.Quantity;c+=n.Quantity*n.Rate});t.sumSellsBase(c);t.sumSellsMarket(l);t.sells(y)}e=h.Nounce;r()}t.disableAnimation=!1}function v(i){var f,e,u;if(i.serviceData&&(f=i.serviceData,t.mySells=[],t.myBuys=[],f&&f.Orders))for(e in f.Orders)u=f.Orders[e],u.Closed||(u.Exchange==n.marketName&&(u.OrderType=="LIMIT_BUY"?t.myBuys.push(u.Limit):u.OrderType=="LIMIT_SELL"&&t.mySells.push(u.Limit)),r());return}function h(){$("#event-store").trigger({type:"request-query-exchange-"+n.marketName})}var t=this,e=-1,i=4,u=[],f=[],o,s;t.disableAnimation=!0;t.showColumns=ko.observable(!0);t.buys=ko.observableArray([]).indexed("rate").extend({rateLimit:500});t.sells=ko.observableArray([]).indexed("rate").extend({rateLimit:500});t.sumBuysBase=ko.observable(0);t.sumBuysMarket=ko.observable(0);t.sumSellsBase=ko.observable(0);t.sumSellsMarket=ko.observable(0);t.myBuys=[];t.mySells=[];t.availableLength=[{value:"10"},{value:"25"},{value:"50"},{value:"100"},];t.selectedLength=ko.observable(t.availableLength[0]);t.showAll=ko.observable(!1);t.showAll.subscribe(function(){h()});t.buyPageIndex=ko.observable(0);t.buyMaxPageIndex=ko.pureComputed(function(){return Math.ceil(t.buys().length/t.selectedLength().value)-1});t.buyPreviousPage=function(){t.buyPageIndex()>0&&(t.disableAnimation=!0,t.buyPageIndex(t.buyPageIndex()-1),t.disableAnimation=!1)};t.buyFirstPage=function(){t.buyPageIndex()>0&&(t.disableAnimation=!0,t.buyPageIndex(0),t.disableAnimation=!1)};t.buyNextPage=function(){t.buyPageIndex()<t.buyMaxPageIndex()&&(t.disableAnimation=!0,t.buyPageIndex(t.buyPageIndex()+1),t.disableAnimation=!1)};t.buyLastPage=function(){t.buyPageIndex()<t.buyMaxPageIndex()&&(t.disableAnimation=!0,t.buyPageIndex(t.buyMaxPageIndex()),t.disableAnimation=!1)};t.buyAllPages=ko.pureComputed(function(){var f=[],r=0,u=t.buyMaxPageIndex(),n;for(t.buyPageIndex()<Math.floor(i/2)?u=i:t.buyPageIndex()>t.buyMaxPageIndex()-i?r=t.buyMaxPageIndex()-i:(r=t.buyPageIndex()-Math.floor(i/2),u=t.buyPageIndex()+Math.ceil(i/2)),n=r;n<=u;n++)f.push({pageNumber:n+1});return f});t.buyMoveToPage=function(n){t.disableAnimation=!0;t.buyPageIndex(n);t.disableAnimation=!1};t.visibleBuys=ko.pureComputed(function(){var n=Number(t.selectedLength().value),i=Number(t.buyPageIndex()*n);return t.buys.slice(i,i+n)});t.sellPageIndex=ko.observable(0);t.sellMaxPageIndex=ko.pureComputed(function(){return Math.ceil(t.sells().length/t.selectedLength().value)-1});t.sellPreviousPage=function(){t.sellPageIndex()>0&&(t.disableAnimation=!0,t.sellPageIndex(t.sellPageIndex()-1),t.disableAnimation=!1)};t.sellFirstPage=function(){t.sellPageIndex()>0&&(t.disableAnimation=!0,t.sellPageIndex(0),t.disableAnimation=!1)};t.sellNextPage=function(){t.sellPageIndex()<t.sellMaxPageIndex()&&(t.disableAnimation=!0,t.sellPageIndex(t.sellPageIndex()+1),t.disableAnimation=!1)};t.sellLastPage=function(){t.sellPageIndex()<t.sellMaxPageIndex()&&(t.disableAnimation=!0,t.sellPageIndex(t.sellMaxPageIndex()),t.disableAnimation=!1)};t.sellAllPages=ko.pureComputed(function(){var f=[],r=0,u=t.sellMaxPageIndex(),n;for(t.sellPageIndex()<Math.floor(i/2)?u=i:t.sellPageIndex()>t.sellMaxPageIndex()-i?r=t.sellMaxPageIndex()-i:(r=t.sellPageIndex()-Math.floor(i/2),u=t.sellPageIndex()+Math.ceil(i/2)),n=r;n<=u;n++)f.push({pageNumber:n+1});return f});t.sellMoveToPage=function(n){t.disableAnimation=!0;t.sellPageIndex(n);t.disableAnimation=!1};t.visibleSells=ko.pureComputed(function(){var n=Number(t.selectedLength().value),i=Number(t.sellPageIndex()*n);return t.sells.slice(i,i+n)});var y=_.debounce(function(){var n=0,i=0;$.each(t.buys(),function(){var t=this;n+=t.total();t.sumBase(n);i+=t.size();t.sumMarket(i)})},1e3),p=_.debounce(function(){var n=0,i=0;$.each(t.sells(),function(){var t=this;n+=t.total();t.sumBase(n);i+=t.size();t.sumMarket(i)})},1e3),r=_.debounce(function(){for(var i,n=0;n<t.buys().length;n++)for(t.buys()[n].orderSize(0),i=0;i<t.myBuys.length;i++)t.myBuys[i]==t.buys()[n].rate()&&t.buys()[n].orderSize(t.myBuys[i]);for(n=0;n<t.sells().length;n++)for(t.sells()[n].orderSize(0),i=0;i<t.mySells.length;i++)t.mySells[i]==t.sells()[n].rate()&&t.sells()[n].orderSize(t.mySells[i])},1e3);$("#event-store").on("data-update-exchange-"+n.marketName,c);$("#event-store").on("data-update-orders",l);$("#event-store").on("data-query-exchange-"+n.marketName,a);$("#event-store").on("data-query-orders",v);o=_.debounce(function(t){$("#event-store").trigger({type:"data-update-bid-"+n.marketName,serviceData:t})},1e3);s=_.debounce(function(t){$("#event-store").trigger({type:"data-update-ask-"+n.marketName,serviceData:t})},1e3);t.resize=function(n){switch(n){case"xs":case"sm":t.showColumns("false");break;case"md":case"lg":t.showColumns("true")}};t.showRow=function(n){n.nodeType!==1||t.disableAnimation||($(n).hide(),$(n).fadeIn(500),$(n).addClass("dyn-tr-add"))};t.showBidRow=function(n){n.nodeType!==1||t.disableAnimation||($(n).hide(),$(n).fadeIn(500),$(n).addClass("dyn-tr-bid-add"))};t.showAskRow=function(n){n.nodeType!==1||t.disableAnimation||($(n).hide(),$(n).fadeIn(500),$(n).addClass("dyn-tr-ask-add"))};t.hideRow=function(n){n.nodeType!==1||t.disableAnimation||($(n).addClass("dyn-tr-remove"),$(n).fadeOut(500,function(){$(n).remove()}))}}function marketOrderBookChart(n,t,i,r,u){"using strict";function s(){for(var t=[],o=u()+u()*f.selectedInterval().intervalValue,s=u()-u()*f.selectedInterval().intervalValue,n=i().length-1;n>=0;n--)i()[n].rate()>=s&&t.push({price:i()[n].rate(),ask:0,bid:i()[n].sumBase().toFixed(2)});for(n=0;n<r().length;n++)r()[n].rate()<=o&&t.push({bid:0,price:r()[n].rate(),ask:r()[n].sumBase().toFixed(2)});e.dataProvider=t;e.validateData()}var f=this,c=t.marketName,e,h,o;f.visible=ko.observable(!1);f.availableInterval=[{intervalName:"25%",intervalValue:.25},{intervalName:"50%",intervalValue:.5},{intervalName:"75%",intervalValue:.75},{intervalName:"100%",intervalValue:1},{intervalName:"All",intervalValue:1e3},];f.selectedInterval=ko.observable(f.availableInterval[0]);f.selectedInterval.subscribe(function(){s()});h=function(n){var i="none",r;i=t.theme=="dark"?"dark":i;r={type:"serial",theme:i,precision:-1,colors:["#7dbc7d","#db4c3c"],legend:{equalWidths:!0,periodValueText:"",position:"top",valueAlign:"left",valueWidth:100},dataProvider:[{user:0,balance:0}],valueAxes:[{stackType:"regular",gridAlpha:.07,position:"left"}],graphs:[{fillAlphas:.6,lineAlpha:.4,title:"Bids",valueField:"bid"},{fillAlphas:.6,lineAlpha:.4,title:"Asks",valueField:"ask"}],plotAreaBorderAlpha:0,marginTop:10,marginLeft:0,marginBottom:0,chartCursor:{cursorAlpha:0},categoryField:"price",categoryAxis:{startOnAxis:!0,axisColor:"#DADADA",gridAlpha:.07,labelRotation:30,labelFunction:function(n,t){return Number(t.category).toFixed(8)}}};e=AmCharts.makeChart(n,r)};i.subscribe(function(){o()});r.subscribe(function(){o()});o=_.debounce(function(){f.visible(!0)&&s()},1e3);$('a[data-toggle="tab"]').on("shown.bs.tab",function(n){switch($(n.target).attr("href")){case"#tabChartOrderBook":f.visible(!0);e&&(e.invalidateSize(),s())}});$('a[data-toggle="tab"]').on("hidden.bs.tab",function(n){switch($(n.target).attr("href")){case"#tabChartOrderBook":f.visible(!1)}});h(n)}function marketSummary(n){var t=this;t.marketName=n.marketName;t.last=ko.observable(0).extend({calculateDelta:""});t.ask=ko.observable(0).extend({calculateDelta:""});t.bid=ko.observable(0).extend({calculateDelta:""});t.spread=ko.observable(0).extend({calculateDelta:""});t.lastUpdated=ko.observable(new moment);t.high=ko.observable(0).extend({calculateDelta:""});t.low=ko.observable(0).extend({calculateDelta:""});t.baseVolume=ko.observable(0).extend({calculateDelta:""});t.marketVolume=ko.observable(0).extend({calculateDelta:""});t.change=ko.observable(0).extend({calculateDelta:""});t._spread=ko.computed(function(){return t.spread(100*(t.ask()-t.bid())/t.ask()),t.spread()},this);t.ath=ko.observable(0);t.atl=ko.observable(0);t.avgVolume=ko.observable(0);t.displayLast=ko.pureComputed(function(){return t.last().toFixed(n.precision)},this);t.displayAsk=ko.pureComputed(function(){return t.ask().toFixed(n.precision)},this);t.displayBid=ko.pureComputed(function(){return t.bid().toFixed(n.precision)},this);t.displayLastUpdated=ko.pureComputed(function(){return t.lastUpdated().format("MM/DD/YYYY hh:mm:ss A")},this);t.displaySpread=ko.pureComputed(function(){return t.spread().toFixed(2)+"%"},this);t.displayHigh=ko.pureComputed(function(){return t.high().toFixed(n.precision)},this);t.displayLow=ko.pureComputed(function(){return t.low().toFixed(n.precision)},this);t.displayBaseVolume=ko.pureComputed(function(){return t.baseVolume().toFixed(n.precisionShort)},this);t.displayMarketVolume=ko.pureComputed(function(){return t.marketVolume().toFixed(n.precisionShort)},this);t.displayAth=ko.pureComputed(function(){return t.ath().toFixed(n.precision)},this).extend({throttle:1e3});t.displayAtl=ko.pureComputed(function(){return t.atl().toFixed(n.precision)},this).extend({throttle:1e3});t.displayAvgVolume=ko.pureComputed(function(){return t.avgVolume().toFixed(n.precision)},this);t.bitcoinPrice=ko.observable(0);t.lastUsd=ko.pureComputed(function(){return(t.last()*t.bitcoinPrice()).toFixed(2)},this);t.askUsd=ko.pureComputed(function(){return(t.ask()*t.bitcoinPrice()).toFixed(2)},this);t.bidUsd=ko.pureComputed(function(){return(t.bid()*t.bitcoinPrice()).toFixed(2)},this);t.highUsd=ko.pureComputed(function(){return(t.high()*t.bitcoinPrice()).toFixed(2)},this);t.lowUsd=ko.pureComputed(function(){return(t.low()*t.bitcoinPrice()).toFixed(2)},this);t.baseVolumeUsd=ko.pureComputed(function(){return(t.baseVolume()*t.bitcoinPrice()).toFixed(2)},this);t.isBtc=ko.pureComputed(function(){return n.baseCurrencyName=="BTC"},this);t.isUsd=ko.pureComputed(function(){return n.baseCurrencyName=="USD"||n.baseCurrencyName=="USDT"},this);t.isCny=ko.pureComputed(function(){return n.baseCurrencyName=="CNY"||n.baseCurrencyName=="BITCNY"},this);var r=t.last.subscribe(function(i){document.title="("+(i?i.toFixed(n.precision):0)+") "+t.marketName+" "+n.marketCurrencyLong}),u=function(n){n&&(t.lastUpdated(new moment),t.last(n.serviceData))},f=function(n){n&&(t.lastUpdated(new moment),t.bid(n.serviceData))},e=function(n){n&&(t.lastUpdated(new moment),t.ask(n.serviceData))},o=function(n){n&&t.ath(n.serviceData)},s=function(n){n&&t.atl(n.serviceData)},h=function(n){n&&n.serviceData.bpi&&t.bitcoinPrice(n.serviceData.bpi.USD.rate_float)},c=function(n){if(n){var r=n.serviceData;for(i=0;i<r.length;i++)r[i].Exchange==t.marketName&&t.avgVolume(r[i].Volume)}},l=function(n){if(n){var r=n.serviceData;for(i=0;i<r.Deltas.length;i++)r.Deltas[i].MarketName==t.marketName&&(t.lastUpdated(new moment),t.high(r.Deltas[i].High),t.low(r.Deltas[i].Low),t.baseVolume(r.Deltas[i].BaseVolume),t.marketVolume(r.Deltas[i].Volume))}},a=function(n){if(n){var r=n.serviceData;for(i=0;i<r.length;i++)r[i].Summary.MarketName==t.marketName&&(t.lastUpdated(new moment),t.high(r[i].Summary.High),t.low(r[i].Summary.Low),t.baseVolume(r[i].Summary.BaseVolume),t.marketVolume(r[i].Summary.Volume))}};$("#event-store").on("data-update-last-"+t.marketName,u);$("#event-store").on("data-update-bid-"+t.marketName,f);$("#event-store").on("data-update-ask-"+t.marketName,e);$("#event-store").on("data-update-ath-"+t.marketName,o);$("#event-store").on("data-update-atl-"+t.marketName,s);$("#event-store").on("data-update-bitcoinPrice",h);$("#event-store").on("data-update-avgVolumes",c);$("#event-store").on("data-update-summaries",l);$("#event-store").on("data-query-summaries",a);t.dispose=function(){r.dispose();_spread.dipose()}}function marketTickChart(n,t){"use strict";function h(){return f=="onemin"}function c(){return f=="tenmin"}function l(){return f=="hour"}function a(){return f=="day"}var r=this,u;r.visible=ko.observable(!1);r.isLoading=ko.observable(!0);var o=-1,f="tenmin",i=[];var w=function(t){if(t){var r=t.serviceData;o+1<r.Nounce?v():o+1==r.Nounce&&(r.OneMin&&h()?i.length>0&&i[i.length-1].T==r.OneMin.T?i[i.length-1]=e(r.OneMin):i.push(e(r.OneMin)):r.TenMin&&c()?i.length>0&&i[i.length-1].T==r.TenMin.T?i[i.length-1]=e(r.TenMin):i.push(e(r.TenMin)):r.Hour&&l()?i.length>0&&i[i.length-1].T==r.Hour.T?i[i.length-1]=e(r.Hour):i.push(e(r.Hour)):r.Day&&a()?i.length>0&&i[i.length-1].T==r.Day.T?i[i.length-1]=e(r.Day):i.push(e(r.Day)):console.log("marketTickChart.tickUpdated(): unknown ticks"),y(n),o=r.Nounce)}},b=function(t){if(t){var r=t.serviceData;r.OneMin&&r.OneMin.length>0&&h()?i=s(r.OneMin):r.TenMin&&r.TenMin.length>0&&c()?i=s(r.TenMin):r.Hour&&r.Hour.length>0&&l()?i=s(r.Hour):r.Day&&r.Day.length>0&&a()?i=s(r.Day):console.log("marketTickChart.tickQueried(): unknown ticks");y(n);o=r.Nounce}},v=function(){$("#event-store").trigger({type:"request-query-tick",serviceData:{marketName:t.marketName,tickSize:f}})};$("#event-store").on("data-update-tick-"+t.marketName,w);$("#event-store").on("data-query-tick-"+t.marketName,b);var y=function(n){u?u.validateData():(k(n),r.isLoading(!1))},k=function(n){function l(n){var i=n.values.value;return"Open:<b>"+n.values.open.toFixed(t.precision)+"<\/b><br>Low:<b>"+n.values.low.toFixed(t.precision)+"<\/b><br>High:<b>"+n.values.high.toFixed(t.precision)+"<\/b><br>Close:<b>"+n.values.close.toFixed(t.precision)+"<\/b><br>"+t.baseCurrencyName+" Volume:<b>"+n.dataContext.baseVolumeAverage.toFixed(t.precision)+"<\/b><br>"+t.marketCurrencyName+" Volume:<b>"+n.dataContext.marketVolumeAverage.toFixed(t.precision)+"<\/b><br>"}var c=i,r=null,e=null,s,o;switch(f){case"onemin":r=[{period:"mm",count:60,label:"1h"},{period:"mm",count:360,label:"6h",selected:!0},{period:"mm",count:1440,label:"1d"},{period:"mm",count:2880,label:"2d"},{period:"mm",count:10080,label:"1w"},{period:"MAX",label:"MAX"}];e={minPeriod:"mm",maxSeries:720,dateFormats:[{period:"fff",format:"JJ:NN:SS"},{period:"ss",format:"JJ:NN:SS"},{period:"mm",format:"JJ:NN"},{period:"hh",format:"JJ:NN"},{period:"DD",format:"MMM DD"},{period:"WW",format:"MMM DD"},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}]};break;case"tenmin":r=[{period:"mm",count:360,label:"6h",selected:!0},{period:"mm",count:1440,label:"1d"},{period:"mm",count:2880,label:"2d"},{period:"mm",count:10080,label:"1w"},{period:"mm",count:20160,label:"2w"},{period:"MAX",label:"MAX"}];e={minPeriod:"10mm",maxSeries:2016,dateFormats:[{period:"fff",format:"JJ:NN:SS"},{period:"ss",format:"JJ:NN:SS"},{period:"mm",format:"JJ:NN"},{period:"hh",format:"JJ:NN"},{period:"DD",format:"MMM DD"},{period:"WW",format:"MMM DD"},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}]};break;case"hour":r=[{period:"mm",count:1440,label:"1d"},{period:"mm",count:2880,label:"2d",selected:!0},{period:"mm",count:10080,label:"1w"},{period:"mm",count:20160,label:"2w"},{period:"hh",count:720,label:"1m"},{period:"hh",count:1440,label:"2m"},{period:"MAX",label:"MAX"}];e={minPeriod:"hh",maxSeries:1440,dateFormats:[{period:"fff",format:"JJ:NN:SS"},{period:"ss",format:"JJ:NN:SS"},{period:"mm",format:"JJ:NN"},{period:"hh",format:"JJ:NN"},{period:"DD",format:"MMM DD"},{period:"WW",format:"MMM DD"},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}]};break;case"day":r=[{period:"mm",count:20160,label:"2w",selected:!0},{period:"hh",count:720,label:"1m"},{period:"hh",count:1440,label:"2m"},{period:"MAX",label:"MAX"}];e={minPeriod:"DD",maxSeries:730,dateFormats:[{period:"fff",format:"JJ:NN:SS"},{period:"ss",format:"JJ:NN:SS"},{period:"mm",format:"JJ:NN"},{period:"hh",format:"JJ:NN"},{period:"DD",format:"MMM DD"},{period:"WW",format:"MMM DD"},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}]}}s={type:"stock",theme:"none",pathToImages:"/scripts/bittrex2/vendor/amstocks-3.14.0/images/",categoryAxesSettings:e,precision:t.isFiat?t.precision:-1,dataSets:[{fieldMappings:[{fromField:"O",toField:"open"},{fromField:"C",toField:"close"},{fromField:"H",toField:"high"},{fromField:"L",toField:"low"},{fromField:"baseVolume",toField:"baseVolume"},{fromField:"marketVolume",toField:"marketVolume"}],color:"#b0de09",dataProvider:c,title:t.marketName,categoryField:"date"}],panels:[{title:"Price",showCategoryAxis:!1,percentHeight:70,valueAxes:[{id:"v1",dashLength:0,position:"left",labelFunction:function(n){return n.toFixed(t.precision)}}],categoryAxis:{dashLength:0,parseDates:!0,equalSpacing:!0},stockGraphs:[{id:"g1",type:"candlestick",proCandlesticks:!0,balloonFunction:l,lineThickness:2,openField:"open",closeField:"close",highField:"high",lowField:"low",valueField:"close",fillColors:"#006600",lineColor:"#006600",lineAlpha:1,fillAlphas:.9,negativeFillColors:"#990000",negativeLineColor:"#990000",title:"Price:",useDataSetColors:!1},{id:"g2",valueField:"close",lineColor:"#fdd400",showBalloon:!1,useDataSetColors:!1}],stockLegend:{equalWidths:!1,valueAlign:"left",valueWidth:120,valueTextRegular:undefined,periodValueTextRegular:"[[value.close]]",valueFunction:function(n,i){return Number(i).toFixed(t.precision)}}},{title:"Volume",percentHeight:30,marginTop:1,showCategoryAxis:!0,valueAxes:[{id:"v2",dashLength:0,position:"left"},{id:"v3",dashLength:0,position:"right"}],categoryAxis:{dashLength:0,parseDates:!0,equalSpacing:!0},stockGraphs:[{title:t.baseCurrencyName,valueField:"baseVolume",type:"column",showBalloon:!1,fillAlphas:1,fillColors:"#7f8da9",lineColor:"#7f8da9",valueAxis:"v2",useDataSetColors:!1},{title:t.marketCurrencyName,valueField:"marketVolume",type:"column",showBalloon:!1,fillAlphas:1,fillColors:"#7dbc7d",lineColor:"#7dbc7d",valueAxis:"v3",useDataSetColors:!1}],stockLegend:{equalWidths:!1,valueAlign:"left",valueWidth:120,periodValueText:"[[value.sum]]",valueTextRegular:"[[value]]"}}],chartScrollbarSettings:{graph:"g1",graphType:"line",usePeriod:"DD"},chartCursorSettings:{valueLineBalloonEnabled:!0,valueBalloonsEnabled:!0},periodSelector:{position:"bottom",inputFieldsEnabled:!1,periods:r}};var a=function(){var n=null,t=null;switch(f){case"onemin":n="minPeriod1mm";break;case"tenmin":n="minPeriod10mm";break;case"hour":n="minPeriod1hh";break;case"day":n="minPeriod1DD"}t=$("#"+n);t.removeClass("amChartsButton");t.addClass("amChartsButtonSelected")},h=function(){$(".amChartsPeriodSelector").length&&$("#intervalSelector").length<=0&&($(".amChartsPeriodSelector").append("<div id='intervalSelector' style='float: left; display: inline;'> Interval:<input type='button' class='amChartsButton' id='minPeriod10mm' value='10m'><input type='button' class='amChartsButton' id='minPeriod1hh' value='1h'><input type='button' class='amChartsButton' id='minPeriod1DD' value='1d'><\/div>"),a())},y=function(){h()},p=function(){h();document.getElementById("minPeriod10mm").onclick=function(){o("10mm","tenmin")};document.getElementById("minPeriod1hh").onclick=function(){o("1h","hour")};document.getElementById("minPeriod1DD").onclick=function(){o("1d","day")}};u=AmCharts.makeChart("divTickChart",s,100);u.addListener("init",y);u.addListener("drawn",p);o=function(t,i){f!=i&&(u.clear(),u=null,$("#"+n).empty(),f=i,v())}},s=function(n){return _.each(n,e)},e=function(n){return n.date=new moment(n.T+" Z").toDate(),n.baseVolume=(n.V*Math.abs((n.C+n.O)/2)).toFixed(4),n.marketVolume=n.V.toFixed(4),n.H>r.allTimeHigh&&(r.allTimeHigh=n.H,p("data-update-ath-",r.allTimeHigh)),n.L<r.allTimeLow&&(r.allTimeLow=n.L,p("data-update-atl-",r.allTimeLow)),n.C=n.C.toFixed(t.precision),n},p=_.debounce(function(n,i){$("#event-store").trigger({type:n+t.marketName,serviceData:i})},1e3);$('a[data-toggle="tab"]').on("shown.bs.tab",function(n){switch($(n.target).attr("href")){case"#tabChartTimeline":r.visible(!0);u&&u.invalidateSize()}});$('a[data-toggle="tab"]').on("hidden.bs.tab",function(n){switch($(n.target).attr("href")){case"#tabChartTimeline":r.visible(!1)}});r.dispose=function(){}}function marketUsdChart(n,t){var i=this,r;i.marketName=t;i.tickNounce=-1;i.defaultTickSize="tenmin";i.tickSize=i.defaultTickSize;i.ticks={};i.ticks.onemin=[];i.ticks.tenmin=[];i.ticks.hour=[];i.ticks.day=[];i.bitcoinPrice=ko.observable(0);var o=function(t){if(t){var r=t.serviceData;i.tickNounce+1<r.Nounce?h():i.tickNounce+1==r.Nounce&&(r.OneMin&&(i.ticks.onemin.length>0&&i.ticks.onemin[i.ticks.onemin.length-1].T==r.OneMin.T?i.ticks.onemin[i.ticks.onemin.length-1]=u(r.OneMin):i.ticks.onemin.push(r.OneMin)),r.TenMin&&(i.ticks.tenmin.length>0&&i.ticks.tenmin[i.ticks.tenmin.length-1].T==r.TenMin.T?i.ticks.tenmin[i.ticks.tenmin.length-1]=u(r.TenMin):i.ticks.tenmin.push(r.TenMin)),r.Hour&&(i.ticks.hour.length>0&&i.ticks.hour[i.ticks.hour.length-1].T==r.Hour.T?i.ticks.hour[i.ticks.hour.length-1]=u(r.Hour):i.ticks.hour.push(r.Hour)),r.Day&&(i.ticks.day.length>0&&i.ticks.day[i.ticks.day.length-1].T==r.Day.T?i.ticks.day[i.ticks.day.length-1]=u(r.Day):i.ticks.day.push(r.Day)),e(n),i.tickNounce=r.Nounce)}},s=function(t){if(t){var r=t.serviceData;r.OneMin&&r.OneMin.length>0&&(i.ticks.onemin=f(r.OneMin));r.TenMin&&r.TenMin.length>0&&(i.ticks.tenmin=f(r.TenMin));r.Hour&&r.Hour.length>0&&(i.ticks.hour=f(r.Hour));r.Day&&r.Day.length>0&&(i.ticks.day=f(r.Day));e(n);i.tickNounce=r.Nounce}},h=function(){$("#event-store").trigger({type:"request-query-tick-"+i.marketName})},c=function(n){n&&n.serviceData.bpi&&i.bitcoinPrice(n.serviceData.bpi.USD.rate_float)};$("#event-store").on("data-update-tick-"+i.marketName,o);$("#event-store").on("data-query-tick-"+i.marketName,s);$("#event-store").on("data-update-bitcoinPrice",c);var e=function(n){r?r.validateData():i.bitcoinPrice()>0&&l(n)},l=function(n){function e(n){var t=n.values.value;return"Open:<b>"+n.values.open.toFixed(8)+"<\/b><br>Low:<b>"+n.values.low.toFixed(8)+"<\/b><br>High:<b>"+n.values.high.toFixed(8)+"<\/b><br>Close:<b>"+n.values.close.toFixed(8)+"<\/b><br>"}function o(n){console.log(n)}var f=i.ticks[i.tickSize],u={type:"stock",theme:"none",pathToImages:"/scripts/bittrex2/vendor/amstocks-3.14.0/images/",categoryAxesSettings:{minPeriod:"mm"},precision:8,dataSets:[{fieldMappings:[{fromField:"O",toField:"open"},{fromField:"C",toField:"close"},{fromField:"H",toField:"high"},{fromField:"L",toField:"low"},{fromField:"baseVolume",toField:"baseVolume"},{fromField:"marketVolume",toField:"marketVolume"}],color:"#7f8da9",dataProvider:f,title:t,categoryField:"date"}],panels:[{title:"Price",showCategoryAxis:!1,percentHeight:70,valueAxes:[{id:"v11",dashLength:5,position:"left"}],categoryAxis:{dashLength:5,parseDates:!0,equalSpacing:!0},stockGraphs:[{id:"g11",type:"candlestick",proCandlesticks:!0,balloonFunction:e,openField:"open",closeField:"close",highField:"high",lowField:"low",valueField:"close",fillColors:"#7dbc7d",lineColor:"#7dbc7d",lineAlpha:1,fillAlphas:.9,negativeFillColors:"#db4c3c",negativeLineColor:"#db4c3c",title:"Price:",useDataSetColors:!1}],stockLegend:{equalWidths:!1,valueAlign:"left",valueWidth:120,valueTextRegular:undefined,periodValueTextRegular:"[[value.close]]"}},{title:"Volume",percentHeight:30,marginTop:1,showCategoryAxis:!0,valueAxes:[{id:"v2",dashLength:5,position:"left"},{id:"v13",dashLength:5,position:"right"}],categoryAxis:{dashLength:5,parseDates:!0,equalSpacing:!0},stockGraphs:[{title:baseCurrencyName,valueField:"baseVolume",type:"column",showBalloon:!1,fillAlphas:1,fillColors:"#7f8da9",lineColor:"#7f8da9",valueAxis:"v12",useDataSetColors:!1},{title:marketCurrencyName,valueField:"marketVolume",type:"column",showBalloon:!1,fillAlphas:1,fillColors:"#7dbc7d",lineColor:"#7dbc7d",valueAxis:"v13",useDataSetColors:!1}],stockLegend:{equalWidths:!1,valueAlign:"left",valueWidth:120,periodValueText:"[[value.sum]]",valueTextRegular:"[[value]]"}}],chartScrollbarSettings:{graph:"g11",graphType:"line",usePeriod:"DD"},chartCursorSettings:{valueLineBalloonEnabled:!0,valueLineEnabled:!0},periodSelector:{position:"bottom",inputFieldsEnabled:!1,hideOutOfScopePeriods:!1,periods:[{period:"mm",count:360,label:"6h",selected:!0},{period:"mm",count:2880,label:"2d"},{period:"mm",count:10080,label:"1w"},{period:"mm",count:20160,label:"2w"},{period:"hh",count:720,label:"1m"},{period:"hh",count:1440,label:"2m"},{period:"MAX",label:"MAX"}]}};AmCharts.addMovingAverage(u.dataSets[0],u.panels[0],"close",{useDataSetColors:!1,color:"#ccffcc",title:"SMA (20)",type:"smoothedLine"},20);AmCharts.addMovingAverage(u.dataSets[0],u.panels[0],"close",{useDataSetColors:!1,color:"#98008f",title:"SMA (50)",type:"smoothedLine"},50);r=AmCharts.makeChart(n,u);r.periodSelector.addListener("changed",o);r.invalidateSize()},f=function(n){return _.each(n,u)},u=function(n){return n.date=new moment(n.T).toDate(),n.O=new Number((n.O*i.bitcoinPrice()).toFixed(4)),n.C=new Number((n.C*i.bitcoinPrice()).toFixed(4)),n.H=new Number((n.H*i.bitcoinPrice()).toFixed(4)),n.L=new Number((n.L*i.bitcoinPrice()).toFixed(4)),n.baseVolume=(n.V*(n.C+n.O)/2).toFixed(4),n.marketVolume=n.V.toFixed(4),n};$('a[data-toggle="tab"]').on("shown.bs.tab",function(n){switch($(n.target).attr("href")){case"#tabChartBitcoin":r&&r.invalidateSize()}})}function marketViewModel(n){"use strict";var t=this,i;t.isFiat=ko.observable(n.isFiat);t.summary=new marketSummary(n);i=document.getElementById("ifrm");i&&(i.src="/market/MarketStandardChart?marketName="+bittrex.market.marketName);t.orderBook=new marketOrderBook(n);t.orderBookChart=new marketOrderBookChart("divOrderbookChart",n,t.orderBook.buys,t.orderBook.sells,t.summary.last);t.history=new marketHistory(n);t.information=new marketInformation(n);typeof userHistoryTable=="function"&&(t.userHistory=new userHistoryTable("closedMarketOrdersTable",{customToolbar:"market-toolbar-order-history"},n));typeof userOpenOrdersTable=="function"&&(t.userOpenOrders=new userOpenOrdersTable("openMarketOrdersTable",{showAlerts:!0,customToolbar:"market-toolbar-orders"},n));typeof userTrade=="function"&&(t.trade=new userTrade(n));typeof walletViewModel=="function"&&(n.baseCurrencyName=="BTC"?(t.wallet=new walletViewModel,t.wallet.setCurrency(n.marketCurrencyName)):t.wallet=null);t.updateMarket=function(n){t.summary.updateMarket(n);t.tickChart.updateMarket(n);t.orderBook.updateMarket(n);t.orderBookChart.updateMarket(n);t.history.updateMarket(n);t.userHistory&&t.userHistory.updateMarket(n);t.userOpenOrders&&t.userOpenOrders.updateMarket(n);t.trade&&t.trade.updateMarket(n);t.deposit&&t.deposit.setCurrency(n.marketCurrencyName);t.withdrawal&&t.withdrawal.setCurrency(n.marketCurrencyName)};t.resize=function(n){t.orderBook.resize(n);t.history.resize(n);t.userHistory&&t.userHistory.resize(n);t.userOpenOrders&&t.userOpenOrders.resize(n);t.userSummaryOpenOrders&&t.userSummaryOpenOrders.resize(n)}}$(function(){"use strict";function i(){screen_xs_size()?n.resize("xs"):screen_sm_size()?n.resize("sm"):screen_md_size()?n.resize("md"):screen_lg_size()&&n.resize("lg")}function f(){var i=bittrex.market.marketName+" $"+bittrex.market.marketCurrencyName,n,r;t&&(i=i+" Last Price "+t+" "+bittrex.market.baseCurrencyName);n=document.createElement("a");n.setAttribute("href","https://twitter.com/share");n.setAttribute("class","twitter-share-button");n.setAttribute("id","twitterbutton");n.setAttribute("data-text",""+i+"");n.setAttribute("data-via","bittrexexchange");n.setAttribute("data-hashtags",bittrex.market.marketCurrencyName);r=$("#tweetbox");r.empty();r.append(n);typeof twttr!="undefined"&&twttr.widgets.load()}var n=new marketViewModel(bittrex.market),r,u,t,e;document.getElementById("market-wrapper")!=null&&ko.applyBindings(n,document.getElementById("market-wrapper"));r=_.debounce(i,500);window.addEventListener("resize",r,!1);$(window).load(i);bittrex.market&&bittrex.market.notice&&$("#id_marketAlert").show();u=function(){var t=getUrlParameters("tab","",!0);if(t)switch(t){case"timeline":$('#tab-wrapper a[href="#tabChartTimeline"]').tab("show");n.tickChart.visible(!0);break;case"orderbook":$('#tab-wrapper a[href="#tabChartOrderBook"]').tab("show");n.orderBookChart.visible(!0);break;case"info":$('#tab-wrapper a[href="#tabInformation"]').tab("show");break;case"wallet":$('#tab-wrapper a[href="#tabWallet"]').tab("show");break;case"social":$('#tab-wrapper a[href="#tabSocial"]').tab("show")}else n.tickChart&&n.tickChart.visible(!0)};u();t=0;f();e=function(n){n&&(t=n.serviceData,f())};$("#event-store").on("data-update-last-"+self.marketName,e)})